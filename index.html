<!DOCTYPE html>
<html>
<head>
  <title>Baby Names Trends (1998-2000)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
  <style>
      body {
          font-family: Arial, sans-serif;
          margin: 20px;
      }

      .tooltip {
          position: absolute;
          padding: 8px;
          background: white;
          border: 1px solid #ddd;
          border-radius: 4px;
          pointer-events: none;
          font-size: 12px;
          opacity: 0;
      }

      .area {
          opacity: 0.7;
          transition: opacity 0.2s;
      }

      .area:hover {
          opacity: 0.9;
      }
  </style>
</head>
<body>
<h2>Top Baby Names - Stacked Totals (1998-2000)</h2>
<div id="chart"></div>

<script>
  // Set the dimensions and margins
  const width = 928;
  const height = 500;
  const marginTop = 20;
  const marginRight = 180;
  const marginBottom = 30;
  const marginLeft = 60;

  // Create SVG container
  const svg = d3.select("#chart")
    .append("svg")
    .attr("width", width)
    .attr("height", height)
    .attr("viewBox", [0, 0, width, height])
    .attr("style", "max-width: 100%; height: auto;");

  d3.csv("https://raw.githubusercontent.com/brycematheson1234/names/refs/heads/master/top_names_by_year_last_8.csv").then(data => {
      // Transform data for stacking
      const years = Array.from(new Set(data.map(d => +d.Year)));
      const names = Array.from(new Set(data.map(d => d.Name)));

      const stackData = years.map(year => {
        const yearData = {year};
        data.filter(d => +d.Year === year).forEach(d => {
          yearData[d.Name] = +d.Count;
        });
        return yearData;
      });

      // Create stack generator
      const stack = d3.stack()
        .keys(names)
        .order(d3.stackOrderNone)
        .offset(d3.stackOffsetNone);

      const series = stack(stackData);

      // Create scales
      const x = d3.scaleLinear()
        .domain(d3.extent(years))
        .range([marginLeft, width - marginRight]);

      const y = d3.scaleLinear()
        .domain([0, d3.max(series, d => d3.max(d, d => d[1]))])
        .range([height - marginBottom, marginTop]);

      const color = d3.scaleOrdinal()
        .domain(names)
        .range(d3.schemeTableau10);

      // Create area generator
      const area = d3.area()
        .x(d => x(d.data.year))
        .y0(d => y(d[0]))
        .y1(d => y(d[1]));

      // Add areas
      const paths = svg.append("g")
        .selectAll("path")
        .data(series)
        .join("path")
        .attr("class", "area")
        .attr("fill", d => color(d.key))
        .attr("d", area);

      // Add X axis
      svg.append("g")
        .attr("transform", `translate(0,${height - marginBottom})`)
        .call(d3.axisBottom(x)
          .ticks(3)
          .tickFormat(d3.format("d")));

      // Add Y axis
      svg.append("g")
        .attr("transform", `translate(${marginLeft},0)`)
        .call(d3.axisLeft(y)
          .ticks(height / 80))
        .call(g => g.select(".domain").remove())
        .call(g => g.selectAll(".tick line").clone()
          .attr("x2", width - marginLeft - marginRight)
          .attr("stroke-opacity", 0.1))
        .call(g => g.append("text")
          .attr("x", -marginLeft)
          .attr("y", 10)
          .attr("fill", "currentColor")
          .attr("text-anchor", "start")
          .text("â†‘ Number of Babies"));

      // Add the legend
      const legend = svg.append("g")
        .attr("font-family", "sans-serif")
        .attr("font-size", 10)
        .attr("text-anchor", "start")
        .selectAll("g")
        .data(series)
        .join("g")
        .attr("transform", (d, i) => `translate(${width - marginRight + 10},${marginTop + i * 20})`);

      legend.append("rect")
        .attr("x", 0)
        .attr("width", 19)
        .attr("height", 19)
        .attr("fill", d => color(d.key));

      legend.append("text")
        .attr("x", 24)
        .attr("y", 9.5)
        .attr("dy", "0.35em")
        .text(d => d.key);

      // Add tooltip
      const tooltip = d3.select("body").append("div")
        .attr("class", "tooltip");

      // Add hover interactions
      paths
        .on("mouseover", function (event, d) {
          d3.select(this).style("opacity", 0.9);
          tooltip.style("opacity", 1);
        })
        .on("mousemove", function (event, d) {
          const [xPos] = d3.pointer(event);
          const year = Math.round(x.invert(xPos));
          const yearData = d.find(p => p.data.year === year);
          if (yearData) {
            const value = yearData[1] - yearData[0];
            tooltip
              .html(`${d.key} (${year})<br>${d3.format(",")(value)} babies`)
              .style("left", (event.pageX + 10) + "px")
              .style("top", (event.pageY - 28) + "px");
          }
        })
        .on("mouseout", function () {
          d3.select(this).style("opacity", 0.7);
          tooltip.style("opacity", 0);
        });

      // Add labels for dimensions
      svg.append("text")
        .attr("x", width / 2)
        .attr("y", height - 5)
        .attr("text-anchor", "middle")
        .text("Year");
    }).catch(error => {
    console.error("Error loading the CSV file:", error);
    document.getElementById("chart").innerHTML = "Error loading data";
  });
</script>
</body>
</html>